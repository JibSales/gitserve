#! /usr/bin/env node

// -- Load modules
var http = require('http');
var optimist = require('optimist');
var colors = require('colors');
var gitserve = require('../lib/gitserve');
var utils = require('../lib/utils');
var pkg = require('../package');

// -- Define argv properties
var argv = optimist
  .usage(utils.usage.join('\n'))
  .options('p', {
    alias: 'port',
    describe: 'Port to start the server on.'.grey,
    default: '3000'
  })
  .options('c', {
    alias: 'config',
    describe: 'Path to the config file.'.grey,
    default: './config.json'
  })
  .options('r', {
    alias: 'repos',
    describe: 'Directory where the repos to serve are located.'.grey,
    default: './'
  })
  .options('i', {
    alias: 'interval',
    describe: 'Interval (seconds) in which config file is reloaded.'.grey,
    default: 30
  })
  .options('h', {
    alias: 'help',
    describe: 'You\'re looking at it.'.grey
  })
  .options('v', {
    alias: 'version',
    describe: 'Print the version number.'.grey
  })
  .argv

// -- Print version number
if (argv.v) {
  console.log(pkg.name + ' v' + pkg.version);
  process.exit(0);
}

// -- Show help screen
if (argv.help || argv._.length === 0) {
  optimist.showHelp();
  process.exit(0);
}

// -- Start simple HTTP server
if ('start' === argv._[0]) {
  var server = gitserve(argv);
  http.createServer(server).listen(argv.port, function () {
    utils.printBootscreen(argv);
  });
}